{% extends "base.html" %}
{% import"_macros.html" as macros %}

{% block title %}周报系统-我的任务{% endblock %}

{% block page_content %}
    <div class="page-header">
       <h1>我的任务</h1>
        {% if as_leader %}<a class="btn btn-default" href="{{ url_for('ms.new_mission_select_group') }}">新建任务</a>
        {% endif %}
    </div>

    <div class="post-tabs">
    <ul class="nav nav-tabs">
        {% if current_user.is_authenticated %}
            <li{% if not as_leader %} class="active"{% endif %}><a href="{{ url_for('ms.as_member') }}">我收到的任务</a></li>
            <li{% if as_leader %} class="active"{% endif %}><a href="{{ url_for('ms.as_leader') }}">我布置的任务</a></li>
        {% endif %}
    </ul>
    <table class="table table-hover users">
    <thead><tr><th>任务名称</th><th>组</th><th>详情</th><th>截止日期</th><th>任务完成情况</th>{% if as_leader %}<th>查看周报</th>{% endif %}<th>结束任务</th></tr></thead>
    {% for mission in missions %}
        <tr>
            <td>
                <a href="{{ url_for('ms.view_mission', mission_id = mission.id) }}">
                    {{ mission.title }}
                </a>
            </td>
            <td>{{ mission.group.group_name }}</td>
            <td><a class="btn btn-default" href="{{ url_for('ms.view_mission', mission_id = mission.id) }}">点击查看</a></td>
            <td>{{ moment(mission.deadline).format('YYYY-MM-DD') }}</td>
            <td>{% if mission.is_accomplished %}已提交{% else %}未提交{% endif %}</td>
            {% if as_leader and mission.is_accomplished %}<td><a class="btn btn-default" href="{{ url_for('wk.view_weekly', weekly_id = mission.weekly_id) }}">查看周报</a></td>{% elif as_leader and not mission.is_accomplished %}<td>尚未提交</td>{% endif %}
            {% if as_leader and not mission.is_terminated %}
                <td><a class="btn btn-danger" href="{{ url_for('ms.terminate', mission_id = mission.id) }}">结束任务</a></td>
                {% elif mission.is_terminated %}
                <td>任务已结束</td>
            {% endif %}
        </tr>
    {% endfor %}
    </table>
    </div>

    <div class="pagination">
        {{ macros.pagination_widget(pagination, endpoint) }}
    </div>

{% endblock %}